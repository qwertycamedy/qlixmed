import { formatPhoneNumber } from '@hooks/formatPhoneNum';
import { productSel, setModalIsOpen } from '@store/slices/product/productSlice';
import { useDispatch, useSelector } from 'react-redux';
import cl from './Bar.module.scss';
import MyBtn from '@components/_UI/btns/MyBtn';
import BotModal from '@components/_UI/botModal/BotModal';
import { Link } from 'react-router-dom';
import BarComp from '@components/product/bar/Bar';
import useWindowWidth from '@hooks/windowWidth';

const Bar = () => {
  const dispatch = useDispatch();
  const { product } = useSelector(productSel);
  const { modalIsOpen } = useSelector(productSel);
  const windowWidth = useWindowWidth();

  const formattedNum = formatPhoneNumber(product.phone);
  const whatsappNum = product.link_whatsapp?.replace(/[^\d]/g, '');

  return (
    <>
      {windowWidth < 1170 ? (
        <>
          <BarComp>
            <MyBtn
              classNames={cl.btn + ' btn-accent'}
              onClick={() => dispatch(setModalIsOpen(true))}
            >
              Связаться с продавцом
            </MyBtn>
          </BarComp>
        </>
      ) : (
        <>
          <MyBtn
            classNames={cl.btn + ' ' + cl.fixedBtn + ' btn-accent'}
            onClick={() => dispatch(setModalIsOpen(true))}
          >
            <svg
            className='ico-24 fill'
              xmlns="http://www.w3.org/2000/svg"
              width="48"
              height="48"
              viewBox="0 0 48 48"
              fill="none"
            >
              <path
                d="M17.536 4.38301C19.597 4.10101 21.329 5.36201 22.149 7.00101L24.166 11.034C25.285 13.272 24.642 15.898 22.946 17.55C21.944 18.525 20.937 19.639 20.353 20.622C20.3143 20.6921 20.3023 20.7737 20.319 20.852C20.859 23.778 22.842 26.669 24.611 28.742C24.7 28.8408 24.8161 28.9113 24.9449 28.9445C25.0736 28.9778 25.2093 28.9724 25.335 28.929L29.31 27.687C30.3808 27.3523 31.5306 27.3694 32.5909 27.7358C33.6512 28.1022 34.5663 28.7987 35.202 29.723L38.079 33.907C38.859 35.043 39.254 36.583 38.656 38.064C38.122 39.387 37.089 41.295 35.21 42.564C33.26 43.88 30.589 44.38 27.094 43.182C23.189 41.842 19.5 38.482 16.441 34.185C13.364 29.861 10.831 24.46 9.29501 18.828C7.84401 13.51 8.72001 9.93001 10.782 7.62501C12.771 5.40101 15.621 4.64601 17.536 4.38301ZM19.913 8.11901C19.456 7.20601 18.641 6.75501 17.876 6.86001C16.175 7.09401 14.045 7.72701 12.646 9.29201C11.32 10.775 10.402 13.387 11.706 18.17C13.171 23.538 15.583 28.668 18.478 32.735C21.391 36.828 24.701 39.718 27.905 40.817C30.76 41.796 32.595 41.312 33.811 40.492C35.097 39.623 35.888 38.242 36.338 37.128C36.544 36.618 36.455 35.958 36.019 35.324L33.142 31.14C32.8091 30.6558 32.3299 30.2909 31.7745 30.0989C31.2192 29.9069 30.6169 29.8978 30.056 30.073L26.081 31.315C24.893 31.686 23.555 31.355 22.71 30.365C20.869 28.208 18.523 24.9 17.86 21.305C17.7333 20.6313 17.8555 19.9344 18.204 19.344C18.962 18.07 20.162 16.771 21.201 15.759C22.216 14.771 22.504 13.301 21.93 12.152L19.913 8.11901Z"
                fill="currentColor"
              />
            </svg>
          </MyBtn>
        </>
      )}
      <BotModal modalIsOpen={modalIsOpen} setModalIsOpen={setModalIsOpen}>
        <Link to={`tel:${product.phone}`}>
          <MyBtn
            classNames={`${cl.call} ${cl.btn}`}
            onClick={() => dispatch(setModalIsOpen(false))}
          >
            {formattedNum}
          </MyBtn>
        </Link>

        <Link to={`https://wa.me/${whatsappNum}`} target="_blank">
          <MyBtn
            classNames={`${cl.whatsapp} ${cl.btn} btn-accent`}
            onClick={() => dispatch(setModalIsOpen(false))}
          >
            <svg
              className={'ico-16 fill'}
              xmlns="http://www.w3.org/2000/svg"
              width="17"
              height="17"
              viewBox="0 0 17 17"
              fill="none"
            >
              <path
                d="M8.50131 1.41699C12.4134 1.41699 15.5846 4.5882 15.5846 8.50033C15.5846 12.4124 12.4134 15.5837 8.50131 15.5837C7.24953 15.5857 6.01978 15.2544 4.9384 14.6239L1.42081 15.5837L2.37848 12.0647C1.74742 10.9829 1.41589 9.75266 1.41798 8.50033C1.41798 4.5882 4.58919 1.41699 8.50131 1.41699ZM6.08731 5.17116L5.94564 5.17683C5.85393 5.18241 5.7643 5.20651 5.68215 5.24766C5.60531 5.29117 5.53516 5.34557 5.4739 5.40916C5.3889 5.4892 5.34073 5.55862 5.28902 5.62591C5.02702 5.96655 4.88596 6.38476 4.8881 6.81449C4.88952 7.16158 4.98019 7.49945 5.12185 7.81537C5.41156 8.45428 5.88827 9.13074 6.51727 9.75762C6.66885 9.90849 6.8176 10.0601 6.97769 10.201C7.75925 10.8892 8.69062 11.3854 9.69769 11.6503L10.1 11.7119C10.2311 11.719 10.3621 11.7091 10.4939 11.7027C10.7001 11.6921 10.9016 11.6362 11.0839 11.5391C11.1767 11.4913 11.2672 11.4393 11.3552 11.3832C11.3552 11.3832 11.3856 11.3634 11.4437 11.3195C11.5394 11.2487 11.5981 11.1984 11.6775 11.1155C11.7363 11.0546 11.7873 10.983 11.8262 10.9016C11.8815 10.7861 11.9367 10.5658 11.9594 10.3824C11.9764 10.2421 11.9714 10.1656 11.9693 10.1182C11.9665 10.0424 11.9034 9.96374 11.8347 9.93045L11.4225 9.74558C11.4225 9.74558 10.8062 9.47712 10.4294 9.3057C10.39 9.28848 10.3477 9.27864 10.3047 9.27666C10.2563 9.27168 10.2073 9.27713 10.1611 9.29265C10.1149 9.30817 10.0726 9.33339 10.037 9.36662C10.0334 9.3652 9.98598 9.40558 9.47385 10.0261C9.44446 10.0656 9.40397 10.0954 9.35755 10.1118C9.31112 10.1282 9.26087 10.1304 9.21319 10.1182C9.16704 10.1058 9.12183 10.0902 9.07789 10.0714C8.99006 10.0346 8.9596 10.0204 8.89939 9.99491C8.49286 9.8175 8.11647 9.57781 7.78377 9.28445C7.69452 9.20653 7.61165 9.12153 7.52665 9.03937C7.24798 8.77249 7.00512 8.47058 6.80414 8.1412L6.76235 8.07391C6.73234 8.02869 6.70807 7.97991 6.6901 7.9287C6.66319 7.82458 6.73331 7.74099 6.73331 7.74099C6.73331 7.74099 6.90544 7.55258 6.98548 7.45057C7.0634 7.35141 7.12927 7.25508 7.17177 7.18637C7.25535 7.05178 7.28156 6.91366 7.23765 6.8067C7.03931 6.3222 6.8339 5.83983 6.62281 5.36099C6.58102 5.26608 6.45706 5.19808 6.34444 5.18462C6.30619 5.18037 6.26794 5.17612 6.22969 5.17328C6.13456 5.16856 6.03924 5.1695 5.94423 5.17612L6.0866 5.17045L6.08731 5.17116Z"
                fill="currentColor"
              />
            </svg>
            Написать на Whatsapp
          </MyBtn>
        </Link>
        <MyBtn
          classNames={`${cl.btn} ${cl.cancel}`}
          onClick={() => dispatch(setModalIsOpen(false))}
        >
          Отмена
        </MyBtn>
      </BotModal>
    </>
  );
};

export default Bar;
